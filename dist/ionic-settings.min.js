!function(n){n.module("ionicSettings.constants",[]).constant("IONIC_SETTINGS_BUTTON","button").constant("IONIC_SETTINGS_PIN","pin").constant("IONIC_SETTINGS_PIN_EMPTY","○").constant("IONIC_SETTINGS_PIN_FILLED","●").constant("IONIC_SETTINGS_SELECTION","selection").constant("IONIC_SETTINGS_TEXT","text"),n.module("ionicSettings.directives",[]).directive("ionSettings",["$ionicSettings","$ionicSettingsConfig","IONIC_SETTINGS_PIN",function(i,t,e){return{restrict:"E",scope:!0,template:'<div ng-repeat="(key, item) in data"><div class="item item-divider" ng-if="!item.type">{{item}}</div><div ng-if="item.type"><ion-item class="item-icon-right"ng-class="{\'item-icon-left\': item.icon}"ng-if="item.type == \'selection\' || item.type == \'button\' || item.type == \'text\'"ng-click="doAction(key)"><div class="ionic-settings-left">{{item.label}}</div><div class="ionic-settings-right ionic-settings-ios" ng-if="!isAndroid && item.type !== \'button\' && item.type !== \'text\'">{{item.value}}</div><div class="ionic-settings-android" ng-if="isAndroid && item.type !== \'button\' && item.type !== \'text\'">{{item.value}}</div><i class="icon {{elementColor}} ionic-settings-icon-smaller {{item.icon}}" ng-if="item.icon"></i><i class="icon {{elementColor}} icon-accessory ion-chevron-right" ng-hide="isAndroid || item.type === \'button\'"></i></ion-item><ion-toggle ng-class="{\'item-icon-left\': item.icon}"toggle-class="toggle-{{color}}"ng-if="item.type === \'toggle\'"ng-model="item.value">{{item.label}}<i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.icon}}" ng-if="item.icon"></i></ion-toggle><ion-toggle ng-class="{\'item-icon-left\': item.icon}"toggle-class="toggle-{{color}}"ng-if="item.type === \'pin\'"ng-change="doAction(key)"ng-init="pin.active = item.value.length === 4"ng-model="pin.active">{{item.label}}<i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.icon}}" ng-if="item.icon"></i></ion-toggle><div class="item item-icon-left" ng-if="item.type === \'input\' && item.icon"><i class="icon {{elementColor}} ionic-settings-icon-smaller {{item.icon}}" ng-if="item.icon"></i><label class="item item-borderless item-input"><span class="input-label" style="margin-left: -13px;">{{item.label}}</span><input type="{{item.inputType}}" ng-model="item.value"></label></div><label class="item item-input" ng-if="item.type === \'input\' && !item.icon"><span class="input-label">{{item.label}}</span><input type="{{item.inputType}}" ng-model="item.value"></label><label class="item" ng-if="item.type === \'range\'"><div class="item-content">{{item.label}}</div><div class="range range-{{color}}"><i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.iconLeft}}"></i><input type="range" name="volume" min="{{item.min}}" max="{{item.max}}" ng-model="item.value"><i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.iconRight}}"></i></div></label></div></div>',link:function(o){var s={},l={};o.data=i.getData(),o.isAndroid=t.isAndroid,o.iconClose=t.iconClose,o.iconClosePosition=t.iconClosePosition,o.iconDone=t.iconDone,o.iconSelected=t.isAndroid?"ion-android-done":"ion-ios-checkmark-empty",o.pin={active:!1},o.showing=!1,o.color=t.color,o.elementColor="stable"===o.color||"default"===o.color||"light"===o.color?"dark":o.color,o.barColor="bar-"+o.color,n.forEach(o.data,function(t,e){l[e]=i.createModal(o,e),o.$watch("data."+e+".value",function(t,s){n.isDefined(t)&&t!==s&&i.store(e,t).then(function(){o.$root.$broadcast(i.changed,{key:e,value:t})},function(){o.data[e].value=s})})}),o.addValue=function(n){4===o.value.length&&(o.value=""),o.value+=n},o.clear=function(){o.value=""},o.dismiss=function(){s.item.type===e&&4!==s.item.value.length&&(o.clear(),o.pin.active=!1),s.modal.isShown()&&s.modal.hide()},o.hidePin=function(){o.showing=!1},o.doAction=function(i){s.modal=l[i],s.item=o.data[i],s.modal?s.item.type===e?4===s.item.value.length?s.item.value="":(o.value=s.item.value,s.modal.show()):s.modal.show():n.isFunction(s.item.onClick)&&s.item.onClick()},o.savePin=function(){s.item.value=o.value,s.modal.hide()},o.select=function(n){s.item.value=n,o.dismiss()},o.showPin=function(){o.showing=!0},o.$on("modal.hidden",o.dismiss),o.$on("$destroy",function(){for(var n in l)l[n]&&l[n].remove()})}}}]).directive("ionSettingsButton",["$ionicSettingsConfig","$ionicSettings",function(n,i){return{template:'<button class="button button-icon icon {{icon}}" ng-click="settingsModal.show()"></button>',$scope:!0,link:function(t){t.barColor="bar-"+n.color,t.icon=n.icon,t.iconClose=n.iconClose,t.iconClosePosition=n.iconClosePosition,t.settingsModal=i.createModal(t),t.title=n.title,t.dismiss=function(){t.settingsModal.hide()}}}}]).directive("ngTouchstart",function(){return{controller:["$scope","$element",function(n,i){function t(t){var e=i.attr("ng-touchstart");n.$event=t,n.$apply(e)}i.bind("touchstart",t)}]}}).directive("ngTouchend",function(){return{controller:["$scope","$element",function(n,i){function t(t){var e=i.attr("ng-touchend");n.$event=t,n.$apply(e)}i.bind("touchend",t)}]}}),n.module("ionicSettings.providers",[]).provider("$ionicSettingsConfig",function(){var n=ionic.Platform.isAndroid(),i=ionic.Platform.isIOS(),t="positive",e=n?"ion-android-settings":"ion-ios-gear",o=n?"ion-android-close":"ion-ios-close-empty",s="right",l=n?"ion-android-done":"ion-ios-checkmark-empty",c=i?"slide-in-up":"ionic-settings-animate-modal-android",a="Settings",r=!0;return{setAndroid:function(i){n=i},setIcon:function(n){e=n},setIconClose:function(n){o=n},setIconClosePosition:function(n){s=n},setModalAnimation:function(n){c=n},setColor:function(n){t=n},setTitle:function(n){a=n},setTouchID:function(n){r=n},$get:function(){return{color:t,icon:e,iconClose:o,iconClosePosition:s,iconDone:l,isAndroid:n,modalAnimation:c,title:a,touchID:r}}}}),n.module("ionicSettings.services",[]).factory("$ionicSettings",["$ionicSettingsConfig","$ionicModal","$log","$q","$rootScope","$window","IONIC_SETTINGS_PIN","IONIC_SETTINGS_SELECTION","IONIC_SETTINGS_TEXT",function(i,t,e,o,s,l,c,a,r){var u,d=this,g={},m=!0;return d.changed="$ionicSettings.changed",d.onInvalidPin="$ionicSettings.onInvalidPin",d.onValidPin="$ionicSettings.onValidPin",d.createModal=function(e,o){var s;if(o){var l=g[o];switch(l.type){case a:s='<ion-modal-view><ion-header-bar ng-class="barColor"><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'left\'" ng-click="dismiss()"></button><h1 class="title">'+l.label+'</h1><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'right\'" ng-click="dismiss()"></button></ion-header-bar><ion-content><ion-item class="item-icon-right" ng-class="{\'active\': data.'+o+'.value === value}" ng-repeat="value in data.'+o+'.values" ng-click="select(value)">{{value}}<i class="icon ion-ios-checkmark-empty positive" ng-show="data.'+o+'.value === value"></i></ion-item></ion-content></ion-modal-view>';break;case c:s='<ion-modal-view><ion-header-bar ng-class="barColor"><div class="buttons" ng-if="iconClosePosition === \'left\'"><button class="button button-icon {{iconDone}}" ng-show="value.length === 4" ng-click="savePin()"></button><button class="button button-icon {{iconClose}}" ng-show="value.length !== 4" ng-click="dismiss()"></button></div><h1 class="title">'+l.label+'</h1><div class="buttons" ng-if="iconClosePosition === \'right\'"><button class="button button-icon {{iconDone}}" ng-show="value.length === 4" ng-click="savePin()"></button><button class="button button-icon {{iconClose}}" ng-show="value.length !== 4" ng-click="dismiss()"></button></div></ion-header-bar><ion-content class="center-vertical"><div class="ionic-settings-numbers"><div class="ionic-settings-numbers-row"><i class="icon ionic-settings-numbers-dot" ng-repeat="$index in [1,2,3,4]" ng-if="!showing" ng-class="{\'ion-ios-circle-outline\': value.length <= $index, \'ion-ios-circle-filled\': value.length > $index}"></i><span class="ionic-settings-numbers-value" ng-repeat="$index in [1,2,3,4]" ng-if="showing">{{value[$index]}}</span></div><div class="ionic-settings-numbers-row" ng-repeat="row in [0,1,2]"><button class="button button-outline button-{{color}} ionic-settings-numbers-button"ng-repeat="col in [1,2,3]"ng-click="addValue(row * 3 + col)">{{row * 3 + col}}</button></div><div class="ionic-settings-numbers-row"><button class="button button-outline button-{{color}} ionic-settings-numbers-button" ng-hide="start" ng-click="clear()">C</button><button class="button button-outline button-{{color}} ionic-settings-numbers-button" ng-click="addValue(0)">0</button><button class="button button-outline button-{{color}} ionic-settings-numbers-button icon ion-eye"ng-hide="start"ng-disabled="value.length !== 4"ng-mousedown="showPin()"ng-mouseup="hidePin()"ng-touchstart="showPin()"ng-touchend="hidePin()"></button></div></div></ion-content></ion-modal-view>';break;case r:s='<ion-modal-view><ion-header-bar ng-class="barColor"><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'left\'" ng-click="dismiss()"></button><h1 class="title">'+l.label+'</h1><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'right\'" ng-click="dismiss()"></button></ion-header-bar><ion-content>'+l.value+"</ion-content></ion-modal-view>",n.extend(e,g[o].scopeObject)}}else s='<ion-modal-view><ion-header-bar ng-class="barColor"><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'left\'" ng-click="dismiss()"></button><h1 class="title">{{title}}</h1><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'right\'" ng-click="dismiss()"></button></ion-header-bar><ion-content><ion-settings></ion-settings></ion-content></ion-modal-view>';return s?t.fromTemplate(s,{scope:e,animation:i.modalAnimation,backdropClickToClose:!1}):void 0},d.fetch=function(n){var i=o.defer();if(l.plugins)l.plugins.appPreferences.fetch(n).then(function(t){null===t?i.reject(t):i.resolve({key:n,value:t})},function(n){i.reject(new Error(n))});else{var t=localStorage[n];void 0===t?i.reject(t):(("true"===t||"false"===t)&&(t="true"===t),i.resolve({key:n,value:t}))}return i.promise},d.fetchAll=function(){var i=[];for(var t in g){var e=g[t];n.isObject(e)&&i.push(d.fetch(t))}return o.all(i).then(function(n){for(var i in n){var t=n[i],e=t.key,o=t.value,s=g[e];s.value=o,s.type===c&&(u={key:e,value:o})}return g})},d.get=function(n){return g[n]?g[n].value:(e.error("Setting key "+n+" is not defined."),void 0)},d.getData=function(){return g},d.init=function(n){g=n;var t=o.defer();return d.fetchAll().then(function(n){if(u&&4===u.value.length){var e=s.$new(),o=d.createModal(e,u.key);e.color=i.color,e.barColor="bar-"+e.color,e.start=!0,e.value="",e.valid=!1;var l=g[u.key];l.onValid&&e.$on(d.onValidPin,l.onValid),l.onInvalid&&e.$on(d.onInvalidPin,l.onInvalid),e.addValue=function(i){e.value+=i,4===e.value.length&&(e.valid=e.value===u.value,e.valid?o.remove().then(function(){if(t.resolve(n),s.$broadcast(d.onValidPin),m)try{navigator.splashscreen.show()}catch(i){}}):(s.$broadcast(d.onInvalidPin,e.value),e.clear())),e.value.length>4&&(e.clear(),e.value+=i)},e.clear=function(){e.value=""},o.show().then(function(){try{navigator.splashscreen.hide()}catch(e){m=!1}if(i.touchID)try{touchid.checkSupport(function(){touchid.authenticate(function(){t.resolve(n)},function(){},"Touch ID")})}catch(e){}})}else t.resolve(n)},function(){d.storeAll(n).then(function(n){t.resolve(n)})}),t.promise},d.set=function(n,i){return g[n].value=i,d.store(n,i)},d.store=function(n,i){var t=o.defer();return l.plugins?l.plugins.appPreferences.store(n,i).then(function(n){t.resolve(n)},function(n){t.reject(new Error(n))}):(localStorage[n]=i,t.resolve(localStorage[n])),t.promise},d.setSelectionValues=function(i,t){return n.copy(t,g[i].values),d.set(i,"")},d.storeAll=function(){var i=[];for(var t in g){var e=g[t];n.isObject(e)&&i.push(d.store(t,e.value))}return o.all(i)},d}]),n.module("ionicSettings",["ionicSettings.constants","ionicSettings.directives","ionicSettings.providers","ionicSettings.services"])}(angular);